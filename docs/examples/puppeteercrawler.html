<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Puppeteer Crawler · Apify SDK</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This example demonstrates how to use [PuppeteerCrawler](https://www.apify.com/docs/sdk/apify-runtime-js/latest#PuppeteerCrawler)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Puppeteer Crawler · Apify SDK"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sdk.apify.com/index.html"/><meta property="og:description" content="This example demonstrates how to use [PuppeteerCrawler](https://www.apify.com/docs/sdk/apify-runtime-js/latest#PuppeteerCrawler)"/><meta property="og:image" content="https://sdk.apify.com/img/apify_logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sdk.apify.com/img/apify_logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/apify_logo.svg" alt="Apify SDK"/><h2 class="headerTitleWithLogo">Apify SDK</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/examples/helloworld" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/docs/examples/basiccrawler" target="_self">Examples</a></li><li class=""><a href="/docs/api/apify" target="_self">API</a></li><li class=""><a href="https://github.com/apifytech/apify-js" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Examples</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Examples</h3><ul><li class="navListItem"><a class="navItem" href="/docs/examples/basiccrawler">Basic Crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/cheeriocrawler">Cheerio Crawler</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/examples/puppeteercrawler">Puppeteer Crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/puppeteerproxy">Puppeteer Proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/puppeteersitemap">Puppeteer Sitemap</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/screenshots">Screenshots</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/callactor">Call Actor</a></li><li class="navListItem"><a class="navItem" href="/docs/examples/synchronousrun">Synchronous Run</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Puppeteer Crawler</h1></header><article><div><span><p>This example demonstrates how to use <a href="https://www.apify.com/docs/sdk/apify-runtime-js/latest#PuppeteerCrawler">PuppeteerCrawler</a>
in combination with <a href="https://www.apify.com/docs/sdk/apify-runtime-js/latest#RequestList">RequestList</a>
and <a href="https://www.apify.com/docs/sdk/apify-runtime-js/latest#RequestQueue">RequestQueue</a> to recursively scrape the
Hacker News website (<a href="https://news.ycombinator.com">https://news.ycombinator.com</a>) using headless Chrome / Puppeteer.
The crawler starts with a single URL, finds links to next pages,
enqueues them and continues until no more desired links are available.
The results are stored to the default dataset. In local configuration, the results are stored as JSON files in <code>./apify_storage/datasets/default</code></p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> Apify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'apify'</span>);

Apify.main(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Create and initialize an instance of the RequestList class that contains the start URL.</span>
    <span class="hljs-keyword">const</span> requestList = <span class="hljs-keyword">new</span> Apify.RequestList({
        <span class="hljs-attr">sources</span>: [
            { <span class="hljs-attr">url</span>: <span class="hljs-string">'http://www.ycombinator.com/'</span> },
        ],
    });
    <span class="hljs-keyword">await</span> requestList.initialize();

    <span class="hljs-comment">// Apify.openRequestQueue() is a factory to get a preconfigured RequestQueue instance.</span>
    <span class="hljs-keyword">const</span> requestQueue = <span class="hljs-keyword">await</span> Apify.openRequestQueue();

    <span class="hljs-comment">// Create an instance of the PuppeteerCrawler class - a crawler</span>
    <span class="hljs-comment">// that automatically loads the URLs in headless Chrome / Puppeteer.</span>
    <span class="hljs-keyword">const</span> crawler = <span class="hljs-keyword">new</span> Apify.PuppeteerCrawler({
        <span class="hljs-comment">// The crawler will first fetch start URLs from the RequestList</span>
        <span class="hljs-comment">// and then the newly discovered URLs from the RequestQueue</span>
        requestList,
        requestQueue,

        <span class="hljs-comment">// Run Puppeteer in headless mode. If you set headless to false, you'll see the scraping</span>
        <span class="hljs-comment">// browsers showing up on your screen. This is great for debugging.</span>
        launchPuppeteerOptions: { <span class="hljs-attr">headless</span>: <span class="hljs-literal">true</span> },

        <span class="hljs-comment">// This function will be called for each URL to crawl.</span>
        <span class="hljs-comment">// Here you can write the Puppeteer scripts you are familiar with,</span>
        <span class="hljs-comment">// with the exception that browsers and pages are automatically managed by the Apify SDK.</span>
        <span class="hljs-comment">// The function accepts a single parameter, which is an object with the following fields:</span>
        <span class="hljs-comment">// - request: an instance of the Request class with information such as URL and HTTP method</span>
        <span class="hljs-comment">// - page: Puppeteer's Page object (see https://pptr.dev/#show=api-class-page)</span>
        handlePageFunction: <span class="hljs-keyword">async</span> ({ request, page }) =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Processing <span class="hljs-subst">${request.url}</span>...`</span>);

            <span class="hljs-comment">// A function to be evaluated by Puppeteer within the browser context.</span>
            <span class="hljs-keyword">const</span> pageFunction = <span class="hljs-function">(<span class="hljs-params">$posts</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> data = [];

                <span class="hljs-comment">// We're getting the title, rank and URL of each post on Hacker News.</span>
                $posts.forEach(<span class="hljs-function">(<span class="hljs-params">$post</span>) =&gt;</span> {
                    data.push({
                        <span class="hljs-attr">title</span>: $post.querySelector(<span class="hljs-string">'.title a'</span>).innerText,
                        <span class="hljs-attr">rank</span>: $post.querySelector(<span class="hljs-string">'.rank'</span>).innerText,
                        <span class="hljs-attr">href</span>: $post.querySelector(<span class="hljs-string">'.title a'</span>).href,
                    });
                });

                <span class="hljs-keyword">return</span> data;
            };
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> page.$$<span class="hljs-built_in">eval</span>(<span class="hljs-string">'.athing'</span>, pageFunction);

            <span class="hljs-comment">// Store the results to the default dataset.</span>
            <span class="hljs-keyword">await</span> Apify.pushData(data);

            <span class="hljs-comment">// Find the link to the next page using Puppeteer functions.</span>
            <span class="hljs-keyword">let</span> nextHref;
            <span class="hljs-keyword">try</span> {
                nextHref = <span class="hljs-keyword">await</span> page.$<span class="hljs-built_in">eval</span>(<span class="hljs-string">'.morelink'</span>, el =&gt; el.href);
            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${request.url}</span> is the last page!`</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// Enqueue the link to the RequestQueue</span>
            <span class="hljs-keyword">await</span> requestQueue.addRequest(<span class="hljs-keyword">new</span> Apify.Request({ <span class="hljs-attr">url</span>: nextHref }));
        },

        <span class="hljs-comment">// This function is called if the page processing failed more than maxRequestRetries+1 times.</span>
        handleFailedRequestFunction: <span class="hljs-keyword">async</span> ({ request }) =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Request <span class="hljs-subst">${request.url}</span> failed too many times`</span>);
        },
    });

    <span class="hljs-comment">// Run the crawler and wait for it to finish.</span>
    <span class="hljs-keyword">await</span> crawler.run();

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Crawler finished.'</span>);
});
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/examples/cheeriocrawler"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/docs/examples/puppeteerproxy"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav docOnPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/apify_logo.svg" alt="Apify SDK" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/examples/helloworld.html">Getting Started</a><a href="/docs/en/examples/basiccrawler.html">Guides</a><a href="/docs/en/api/apify.html">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/apify" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/apify" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/apifytech" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://www.apify.com" target="_blank">Apify Cloud Platform</a><a href="https://github.com/apifytech/apify-js" target="_blank">GitHub</a><a class="github-button" href="https://github.com/apifytech/apify-js" data-icon="octicon-star" data-count-href="/apifytech/apify-js/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star Apify SDK on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2018 Apify Technologies s.r.o.</section></footer></div></body></html>